<html>
    <head>
        <style>
            *{
                margin:0;
                padding:0;
            }
            #container{
                width:1000px;
                height:1000px;
            }
            .cube{
                display: inline-block;
                width:100px;
                height:100px;
                background-color: #eee;
                margin:0;
            }
        </style>
        <script src="jquery.js"></script>
        <script>
            var cubeListA = [{id:"a",order:0},{id:"b",order:1},{id:"c",order:2}];
            var cubeListB = [{id:"d",order:0},{id:"e",order:1},{id:"f",order:2}];
            
            (function($){
                $.fn.bijiPanel = function(opt) {
                    var container = this;
                    var defaults = {
                        'color': 'red',
                        'fontSize': '12px'
                    };
                    var options = $.extend(defaults, opt);
                    function bindEvent(){
                        console.info("bind event");
                        $(".cube").on('mousedown',function(e){
                            //e.preventDefault();
                            var selectCube = $(this);
                            var selectCubeParent = selectCube.parent();
                            var selectCubeOrder = parseInt(selectCube.attr('order'));
                            var X = e.clientX - selectCube.offset().left;
                            var Y = e.clientY - selectCube.offset().top;
                            var attr = [];
                            var order;
                            var cubes = [];
                            var cubeElements = container.find(".cube");
                            for(var i = cubeElements.length-1;i >= 0;i--){
                                var cube = $(cubeElements[i]);
                                var cubeOffset = cube.offset();
                                cubes.push({order:parseInt(cube.attr("order")),
                                  left:cubeOffset.left,
                                  top:cubeOffset.top,
                                  right:cubeOffset.left + cube.width(),
                                  bottom:cubeOffset.top + cube.height()});
                                cube.css({'position':'absolute',
                                          'left':cubeOffset.left+'px',
                                          'top':cubeOffset.top+'px'});
                            }
                            
                            selectCube.css({'opacity':0.9,'zIndex':1});
                            $('.cube').each(function() {
                                attr.push($(this).attr('order'));
                            });
                            $(document).on('mousemove',function(e){
                                var selectCubeLeft = e.clientX - X,
                                    selectCubeTop = e.clientY - Y,
                                    currentCubeLeft = e.clientX - selectCubeParent.offset().left,
                                    currentCubeTop = e.clientY - selectCubeParent.offset().top;
                                selectCube.css({'left':selectCubeLeft+'px','top':selectCubeTop+'px'});
                                for(var i=0;i<cubes.length;i++){
                                    var swapCubeOrder = cubes[i].order;
                                    
                                    if(currentCubeLeft > cubes[i].left &&
                                       currentCubeLeft < cubes[i].right&&
                                       currentCubeTop > cubes[i].top&& 
                                       currentCubeTop < cubes[i].bottom){
                                        if(swapCubeOrder == selectCubeOrder)continue;
                                        order = swapCubeOrder;              //当找到元素保存要抵达的位置的index
                                        
                                        
                                    if(selectCubeOrder>swapCubeOrder){
                                        for(var j=selectCubeOrder-1; j>=swapCubeOrder; j--){
                                            //test(1,j);
                                            var c = $('.cube[order='+j+']');
                                            $(c).stop();
                                            var t;
                                            for(var i = 0;i < cubes.length;i++){
                                                if(cubes[i].order == j+1){
                                                  t = cubes[i];  
                                                }
                                            }
                                            c.animate({
                                                left:t.left,
                                                top:t.top
                                            },'fast');                
                                            c.attr('order',j+1);
                                        }                                    
                                    }else{
                                        for(var j=selectCubeOrder+1; j<swapCubeOrder+1; j++){ 
                                            //test(-1,j); 
                                            var c = $('.cube[order='+j+']');
                                            $(c).stop();
                                            var t;
                                            for(var i = 0;i < cubes.length;i++){
                                                if(cubes[i].order == j-1){
                                                  t = cubes[i];  
                                                }
                                            }
                                            c.animate({
                                                left:t.left,
                                                top:t.top
                                            },'fast');                
                                            c.attr('order',j-1);
                                        }                                    
                                    };
                                    selectCube.attr('order',swapCubeOrder);  //变换_this的index
                        
                                    }else{
                                        order = selectCubeOrder;
                                    } 
                                }
                            });         
                            $(".cube").on('mouseup',function(){
                                $(this).off('mousemove');
                                $(this).off('mouseup');
                                var t;
                                for(var i = 0;i < cubes.length;i++){
                                    if(cubes[i].order == order){
                                        t = cubes[i];  
                                    }
                                }
                                selectCube.animate({
                                    left:parseInt(t.left),
                                    top:parseInt(t.top)
                                },'fast',function(){
                                    selectCube.css({'opacity':1,'zIndex':0})         
                                });
                            });                 
                        });
                        
                        
                    }
                    var _bijiPanel = {
                        test:function(){
                            console.info("haha");
                            return this;
                        },
                        init:function(){
                            $.each(options.data,function(i,v){
                                container.append('<div id = "' + v.id + '" class = "cube" order = "' + v.order + '"></div>');  
                            });
                            bindEvent();
                        }
                        
                    }
                    return _bijiPanel;
                }
            })(jQuery);
            $(document).ready(function () {
                var panel = $("#container").bijiPanel({data:cubeListA}).init();
                
            });

        </script>
    </head>
    
    <body>
        <div id = "container">
        </div>
    </body>
</html>